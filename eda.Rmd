---
title: "eda_analytics_cup"
author: 
  name: Manuel Schreiber
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
    df_print: paged
  html_notebook: default
  latex_engine: pdflatex
  pdf_document: default
  header-includes:
   - \usepackage{amsmath}
   - \usepackage{amsfonts}
---

**Task** 

**January 11: payments.csv file from training data updated**

Predict Ownership Interests of physicians in pharmaceutical companies from regulatory transaction data.

**Task description:**

You are given 1 400 000 instances of transactions which have been received by 6000 physicians in the years 2013 to 2019 (transactions.csv), as well as additional data about these doctors (physicians.csv) and companies (companies.csv). For 5000 of these doctors, transactions related to ownership interest (if any) are included, for the other 1000 (the test set), these kinds of transactions have been removed from the transaction data. For each of these 1000 physicians, your model must make a prediction about whether they have had such ownership interests (prediction=1) or not (prediction=0).

```{r}
# clear workspace
##rm(list=ls())
```




```{r}
# Loading Packages

library(tidyverse) # collection of packages for data analysis including: ggplot2 (data visualization package), dplyr (data manipulation package), tidyr, readr (faster read.csv() functions that create tibble objects instead of data.frames), purrr, tibble (wrapper around data.frames for better printing), stringr, forcats

library(lubridate) # tools to parse and manipuulate dates

library(GGally) # ggplot2 extension (for a heat map plot)

library(graphics) # base graphics (e.g. histogram)

library(stats) # computing distribution functions, distribution quantiles; random number generation


library(tidymodels) # collection of packages for modeling and machine learning

library(googledrive) # interface to googledrive


```

```{r}
# obtaining your current working directory
getwd()
```


```{r}
# finds all CSV files on your google drive
drive_find(type = "csv")  

# downloading a file from Gdrive to your working directory
##drive_download("water_qual.csv", overwrite = TRUE)

# uploading a file to Gdrive 
##drive_upload()

# updating a file on Gdrive
##drive_update()

# deleting files on Gdrive
##drive_rm()


```

```{r}
##drive_download("physicians.csv")
#drive_download("payments.csv", overwrite = TRUE)

```

# Exploratory Data Analysis

## Physicians dataframe

```{r}
physicians_df <- read_delim("physicians.csv", delim = ",")
```

```{r}
str(physicians_df)
```


```{r}

head(physicians_df)

# interesting features: id -> way to join with payments df
```



```{r}
# finding the number of NA values by column in the physicians df
physicians_df %>% mutate_all(is.na) %>% summarize_all(sum)
```

```{r}
# all colnames  
colnames(physicians_df) 

# reduced dataframe -: removing variables
physicians_df_red <- subset(physicians_df, select = -c(First_Name,Middle_Name,Last_Name, Name_Suffix))
                      

# storing all physician id's for the training set
id_train <- physicians_df_red$id[physicians_df_red$set=="train"]

# storing all physician id's for the test set
id_test <- physicians_df_red$id[physicians_df_red$set=="test"]

                        
  


```


## payments dataframe

```{r}
payments_df <- read_delim("payments.csv", delim = ",")
```

```{r}
str(payments_df)
# interesting features. Physician_ID, Company_ID, Ownership_Indicator
```

```{r}
# storing the physician IDs which match in physicians_df and payments_df is equal to "yes"

payments_physicians_matching_ids_train <- payments_df$Physician_ID[payments_df$Physician_ID == id_train]

payments_physicians_matching_ids_test <- payments_df$Physician_ID[payments_df$Physician_ID == id_test]

# object lengths
length(payments_physicians_matching_ids_test)

length(payments_physicians_matching_ids_train)

# extracting ownership indicators for training and test set
ownership_mid_train <- payments_df$Ownership_Indicator[payments_df$Physician_ID == id_train]


ownership_mid_test <- payments_df$Ownership_Indicator[payments_df$Physician_ID == id_test]

# training set with mathing physician ids and ownership labels
train_df <- cbind(payments_physicians_matching_ids_train, ownership_mid_train)

head(train_df, 50)


length(payments_df$Number_of_Payments)

unique(payments_df$Number_of_Payments) # all payments where greater or equal to 1


```



```{r}
unique(payments_df$Ownership_Indicator)

unique(payments_df$Nature_of_Payment_or_Transfer_of_Value)

# for loop which returns all unique values of each feature in the payments df
for (i in (1:length(payments_df))) { 
 print(unique(payments_df[i]))
}

```



```{r}
# finding the number of NA values by column in the payments df
payments_df %>% mutate_all(is.na) %>% summarize_all(sum)
```

```{r}
summary(payments_df)
```

## companies dataframe

```{r}
companies_df <- read_delim("companies.csv", delim = ",")
```

```{r}
str(companies_df)
```



```{r}
# uploading the markdown file to gdrive
##drive_upload("eda.html")
```


